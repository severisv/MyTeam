@using System.Threading.Tasks
@model MyTeam.ViewModels.Shared.CloudinaryConfiguration
@if (Context.Request.IsAjaxRequest())
{
    <script src="~/compiled/lib/lib.bundle.js"></script>
}
<script src="~/compiled/lib/cloudinary.bundle.js"></script>
<script>

    $.cloudinary.config({ cloud_name: '@Model.CloudName', api_key: '@Model.ApiKey', signature: '@Model.Signature' });

    var formData = {
        api_key: '@Model.ApiKey',
        timestamp: '@Model.UnixTimestamp',
        signature: '@Model.Signature'
    }

    $('.cloudinary-fileupload').each(function () {
        $(this).attr('data-form-data', JSON.stringify(formData));
    });

    $('.cloudinary-fileupload').bind('cloudinarydone', function (e, data) {
        $('.cloudinary-preview').html(
          $.cloudinary.image(data.result.public_id,
            {
                format: data.result.format, version: data.result.version,
                crop: 'fill'
            })
        );
        return true;
    });
    $('.cloudinary-fileupload').bind('fileuploadprogress', function (e, data) {
        $('.cloudinary-progress-bar').css('width', Math.round((data.loaded * 100.0) / data.total) + '%');
    });
</script>